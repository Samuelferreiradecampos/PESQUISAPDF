import fitz  # PyMuPDF
import os
import threading

def buscar_informacoes(pdf_path, nome, numero_rf, resultado_callback):
    doc = fitz.open(pdf_path)
    informacoes_encontradas = []

    for page_num in range(doc.page_count):
        page = doc[page_num]
        text = page.get_text("text")
        
        for linha in text.split('\n'):
            # Procurar pelo nome
            if nome in linha:
                informacoes_encontradas.append({"Tipo": "Nome", "Valor": nome})
            
            # Procurar pelo número de RF
            elif numero_rf in linha:
                informacoes_encontradas.append({"Tipo": "Número de RF", "Valor": numero_rf})

    doc.close()

    # Chamar a função de retorno de resultado com as informações encontradas
    resultado_callback(informacoes_encontradas)

def exibir_resultado_pesquisa(resultado_pesquisa):
    if resultado_pesquisa:
        print("\nResultados encontrados:")
        for resultado in resultado_pesquisa:
            print(f"Tipo: {resultado['Tipo']}, Valor: {resultado['Valor']}")
    else:
        print("\nNenhum resultado encontrado.")

if __name__ == "__main__":
    # Caminho do PDF no desktop
    pdf_path_no_desktop = os.path.join(os.path.expanduser('~'), 'Desktop', 'documento.pdf')

    # Informações a serem procuradas
    nome_procurado = "Samuel Ferreira de Campos"
    numero_rf_procurado = "8346178"

    # Iniciar a pesquisa em uma thread separada
    thread_pesquisa = threading.Thread(target=buscar_informacoes, args=(pdf_path_no_desktop, nome_procurado, numero_rf_procurado, exibir_resultado_pesquisa))
    thread_pesquisa.start()

    # Exibir mensagem "Pesquisando..."
    print("Pesquisando...")

    # Aguardar até que a pesquisa seja concluída
    thread_pesquisa.join()
